<?xml version="1.0" encoding="utf-8" ?>
<views:BasePage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:views="clr-namespace:GeorgaMobileClient.View"
             xmlns:viewmodels="clr-namespace:GeorgaMobileClient.ViewModel"
             xmlns:behaviors="clr-namespace:CommunityToolkit.Maui.Behaviors;assembly=CommunityToolkit.Maui"
             xmlns:converters="clr-namespace:CommunityToolkit.Maui.Converters;assembly=CommunityToolkit.Maui"
             xmlns:ctviews="clr-namespace:CommunityToolkit.Maui.Views;assembly=CommunityToolkit.Maui"                
             x:Class="GeorgaMobileClient.LoginPage"
             x:DataType="viewmodels:LoginViewModel"
             Title="Login"
             Shell.NavBarIsVisible="False">
    
    <views:BasePage.BindingContext>
        <viewmodels:LoginViewModel x:Name="ViewModel" />
    </views:BasePage.BindingContext>
    
    <views:BasePage.Resources>
        
        <Style x:Key="InvalidStyle" TargetType="Entry">
            <Setter Property="TextColor" Value="Red" />
        </Style>

        <ResourceDictionary>
            <converters:InvertedBoolConverter x:Key="invertBoolConverter" />
        </ResourceDictionary>
        
    </views:BasePage.Resources>
    
    <Grid Style="{StaticResource ContentArea}">

        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="*" />
            <RowDefinition Height="auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="auto" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>
        <StackLayout Grid.Row="2" Grid.Column="1" HorizontalOptions="Center" WidthRequest="200" VerticalOptions="Center">
            <Entry x:Name="email" Placeholder="EMail" Text="{Binding Email}">
                <Entry.Behaviors>
                    <behaviors:EmailValidationBehavior IsValid="{Binding IsEmailValid}" Flags="ValidateOnValueChanged" InvalidStyle="{StaticResource InvalidStyle}"/>
                </Entry.Behaviors>
            </Entry>
            <Entry x:Name="password" Placeholder="Password" IsPassword = "true" Text="{Binding Password}" />
            <Button Text="Login" Command="{Binding LoginCommand}" IsEnabled="{Binding HasErrors, Converter={StaticResource invertBoolConverter}}" />
            <Entry x:Name="repeatPasswordEntry" Placeholder="Repeat password" IsPassword = "true" Text="{Binding RepeatPassword}" IsVisible="{Binding IsRepeatPasswordVisible}" >
                <Entry.Behaviors>
                    <behaviors:RequiredStringValidationBehavior IsValid="{Binding IsPasswordMatching}" RequiredString="{Binding Password}" Flags="ValidateOnValueChanged" InvalidStyle="{StaticResource InvalidStyle}"/>
                </Entry.Behaviors>
            </Entry>
            <Button Text="Register new account" Command="{Binding RegisterCommand}" Clicked="OnRegisterClicked" />
        </StackLayout>

        <StackLayout Grid.Row="3" Grid.Column="1" HorizontalOptions="Center" VerticalOptions="Center">
            <Label Text="Email address not valid" TextColor="Red" IsVisible="{Binding IsEmailValid, Converter={StaticResource invertBoolConverter}}" />
            <Label Text="Please provide an email address" TextColor="Red" IsVisible="{Binding IsEmailEmpty}" />
            <Label Text="Passwords don't match" TextColor="Red" IsVisible="{Binding IsPasswordMatching, Converter={StaticResource invertBoolConverter}}" />
            <Label Text="{Binding Result}"  LineBreakMode="WordWrap" WidthRequest="300" />
        </StackLayout>        

    </Grid>
</views:BasePage>